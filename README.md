<h2>Пример реализации SAGA</h2>

У нас есть сервис, в задачу которого входит организация путешествия. За каждый участок отвечает какой-то внешний сервис
- кто-то заказывает авиабилеты, кто-то такси, кто-то комнату в отеле.
Задача оркестратора или забронировать все 3 позиции или отменить все. Если хоть один из исполнителей не смог выполнить
задачу - работа остальных для нас не имеет значения.

У нас есть 4 SpringBoot-сервиса. Все они используют kafka как шину данных для общения между собой.
Все сервисы максимально упрощены - используют h2, содержат rest-data для контроля содержимого базы.

<h2>Запуск</h2>

Запустите kafka используя docker-compose.

/docker/docker-compose.yaml

После этого в любой последовательности запустите модули order, transfer, hotel, airport. Каждый сервис обладает всей
нужной информацией для взаимодействия с kafka - сам создает топики и подключается к ним.

<h2>Отслеживание содержимого H2 в сервисах</h2>

Для упрощения воспользуемся инструментов rest-data, позволяющим быстро обеспечить отображение записей в таблицах.

Адреса для сервисов:

- Заказы - http://localhost:8080/orders
- Авиабилеты - http://localhost:8082/tickets
- Номера отеля - http://localhost:8086/rooms
- Такси - http://localhost:8084/taxi

<h2>Заказ</h2>
Чтобы сгенерировать пробный заказ - вызовите следующий endpoint

```
POST http://localhost:8080/v1/order
```

<h2>Как это работает</h2>

Клиент просит систему сгенерировать ему заказ. Создается запись в базе данных и отправляется сообщение на шину (kafka).
Каждый из сервисов подписан на топик-информатор и имеет своб встроенную логику обработки. Сейчас для упрощения добавлены
случайные отказы (5%).

![Схема запроса](/doc/kafka-saga-start.png)

После обработки события сервис должен или прислать сообщение об успехе и идентификатор заказа у себя (номер билета,
комнаты, машины такси) или сообщить об ошибке.
Оркестратор в свою очередь читает очередь с результатами и отмечает степень выполнения того или иного заказа.

![Схема ответа](/doc/kafka-saga-airport-response.png)

Если хоть один сервис ответил ошибкой - система рассылает уведомление от откате операции. Если сервис уже забронировал
что-то для данного заказа - он это отменит.

Как только order наберет полный чек-лист для заказа - он сможет разослать сообщение о подтверждении всех предварительно
забронированных сущностей. Следом будет отослано сообщение-нотификация клиенту, мониторингу или любым другим
заинтересованным сторонам.

